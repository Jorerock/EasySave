<Window x:Class="EasySave.WPF.Views.MainWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
        xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
        xmlns:vm="clr-namespace:EasySave.WPF.ViewModels"
        mc:Ignorable="d"
        Title="{DynamicResource Main_Title}"
        Height="700"
        Width="1100"
        WindowStartupLocation="CenterScreen">

    <Window.Resources>

        <!-- Style bouton icône Pause/Play/Stop -->
        <Style x:Key="IconButton" TargetType="Button">
            <Setter Property="Width" Value="32"/>
            <Setter Property="Height" Value="32"/>
            <Setter Property="Margin" Value="2,0"/>
            <Setter Property="FontSize" Value="14"/>
            <Setter Property="Cursor" Value="Hand"/>
            <Setter Property="Background" Value="Transparent"/>
            <Setter Property="BorderBrush" Value="#CCCCCC"/>
            <Setter Property="BorderThickness" Value="1"/>
            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="Button">
                        <Border Background="{TemplateBinding Background}"
                                BorderBrush="{TemplateBinding BorderBrush}"
                                BorderThickness="{TemplateBinding BorderThickness}"
                                CornerRadius="4">
                            <ContentPresenter HorizontalAlignment="Center" VerticalAlignment="Center"/>
                        </Border>
                        <ControlTemplate.Triggers>
                            <Trigger Property="IsMouseOver" Value="True">
                                <Setter Property="Background" Value="#E3F2FD"/>
                            </Trigger>
                            <Trigger Property="IsEnabled" Value="False">
                                <Setter Property="Opacity" Value="0.4"/>
                            </Trigger>
                        </ControlTemplate.Triggers>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
        </Style>

        <!-- DataTemplate carte de suivi d'un job en cours -->
        <DataTemplate x:Key="RunningJobTemplate" DataType="{x:Type vm:BackupJobViewModel}">
            <Border Background="White"
                    BorderBrush="#E0E0E0"
                    BorderThickness="1"
                    CornerRadius="4"
                    Margin="0,3"
                    Padding="10,8">
                <Grid>
                    <Grid.RowDefinitions>
                        <RowDefinition Height="Auto"/>
                        <RowDefinition Height="5"/>
                        <RowDefinition Height="Auto"/>
                        <RowDefinition Height="4"/>
                        <RowDefinition Height="Auto"/>
                    </Grid.RowDefinitions>
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="*"/>
                        <ColumnDefinition Width="Auto"/>
                    </Grid.ColumnDefinitions>

                    <!-- Ligne 1 : Nom + badge état -->
                    <StackPanel Grid.Row="0" Grid.Column="0"
                                Orientation="Horizontal"
                                VerticalAlignment="Center">
                        <TextBlock Text="{Binding Job.Name, Mode=OneWay}"
                                   FontWeight="SemiBold"
                                   FontSize="13"/>
                        <Border Margin="8,0,0,0" CornerRadius="8" Padding="6,1">
                            <Border.Style>
                                <Style TargetType="Border">
                                    <Setter Property="Background" Value="#E8F5E9"/>
                                    <Style.Triggers>
                                        <DataTrigger Binding="{Binding State, Mode=OneWay}" Value="Paused">
                                            <Setter Property="Background" Value="#FFF8E1"/>
                                        </DataTrigger>
                                        <DataTrigger Binding="{Binding State, Mode=OneWay}" Value="Stopped">
                                            <Setter Property="Background" Value="#FEEBEE"/>
                                        </DataTrigger>
                                        <DataTrigger Binding="{Binding State, Mode=OneWay}" Value="Failed">
                                            <Setter Property="Background" Value="#FEEBEE"/>
                                        </DataTrigger>
                                        <DataTrigger Binding="{Binding State, Mode=OneWay}" Value="Completed">
                                            <Setter Property="Background" Value="#E3F2FD"/>
                                        </DataTrigger>
                                        <DataTrigger Binding="{Binding State, Mode=OneWay}" Value="Idle">
                                            <Setter Property="Background" Value="#F5F5F5"/>
                                        </DataTrigger>
                                    </Style.Triggers>
                                </Style>
                            </Border.Style>
                            <TextBlock Text="{Binding StateLabel, Mode=OneWay}"
                                       FontSize="11" FontWeight="Medium">
                                <TextBlock.Style>
                                    <Style TargetType="TextBlock">
                                        <Setter Property="Foreground" Value="#2E7D32"/>
                                        <Style.Triggers>
                                            <DataTrigger Binding="{Binding State, Mode=OneWay}" Value="Paused">
                                                <Setter Property="Foreground" Value="#F57F17"/>
                                            </DataTrigger>
                                            <DataTrigger Binding="{Binding State, Mode=OneWay}" Value="Stopped">
                                                <Setter Property="Foreground" Value="#C62828"/>
                                            </DataTrigger>
                                            <DataTrigger Binding="{Binding State, Mode=OneWay}" Value="Failed">
                                                <Setter Property="Foreground" Value="#C62828"/>
                                            </DataTrigger>
                                            <DataTrigger Binding="{Binding State, Mode=OneWay}" Value="Completed">
                                                <Setter Property="Foreground" Value="#1565C0"/>
                                            </DataTrigger>
                                            <DataTrigger Binding="{Binding State, Mode=OneWay}" Value="Idle">
                                                <Setter Property="Foreground" Value="#616161"/>
                                            </DataTrigger>
                                        </Style.Triggers>
                                    </Style>
                                </TextBlock.Style>
                            </TextBlock>
                        </Border>
                    </StackPanel>

                    <!-- Boutons Pause / Play / Stop -->
                    <StackPanel Grid.Row="0" Grid.Column="1"
                                Orientation="Horizontal"
                                VerticalAlignment="Center">
                        <Button Style="{StaticResource IconButton}"
                                Content="⏸" ToolTip="Pause"
                                Command="{Binding PauseCommand}"/>
                        <Button Style="{StaticResource IconButton}"
                                Content="▶" ToolTip="Reprendre"
                                Command="{Binding PlayCommand}"/>
                        <Button Style="{StaticResource IconButton}"
                                Content="⏹" ToolTip="Arrêter"
                                Command="{Binding StopCommand}"/>
                    </StackPanel>

                    <!-- Barre de progression -->
                    <ProgressBar Grid.Row="2" Grid.ColumnSpan="2"
                                 Value="{Binding Progress, Mode=OneWay}">
                        <ProgressBar.Style>
                            <Style TargetType="ProgressBar">
                                <Setter Property="Height" Value="12"/>
                                <Setter Property="Minimum" Value="0"/>
                                <Setter Property="Maximum" Value="100"/>
                                <Setter Property="Foreground" Value="#2196F3"/>
                                <Style.Triggers>
                                    <DataTrigger Binding="{Binding State, Mode=OneWay}" Value="Paused">
                                        <Setter Property="Foreground" Value="#FFA726"/>
                                    </DataTrigger>
                                    <DataTrigger Binding="{Binding State, Mode=OneWay}" Value="Completed">
                                        <Setter Property="Foreground" Value="#43A047"/>
                                    </DataTrigger>
                                    <DataTrigger Binding="{Binding State, Mode=OneWay}" Value="Failed">
                                        <Setter Property="Foreground" Value="#E53935"/>
                                    </DataTrigger>
                                    <DataTrigger Binding="{Binding State, Mode=OneWay}" Value="Stopped">
                                        <Setter Property="Foreground" Value="#E53935"/>
                                    </DataTrigger>
                                </Style.Triggers>
                            </Style>
                        </ProgressBar.Style>
                    </ProgressBar>

                    <!-- Détails : % fichiers et fichier en cours -->
                    <StackPanel Grid.Row="4" Grid.ColumnSpan="2" Orientation="Horizontal">
                        <TextBlock FontSize="11" Foreground="#555">
                            <Run Text="{Binding Progress, Mode=OneWay, StringFormat={}{0}%}"/>
                            <Run Text=" — "/>
                            <Run Text="{Binding FilesRemaining, Mode=OneWay, StringFormat={}Restants : {0}}"/>
                            <Run Text=" / "/>
                            <Run Text="{Binding TotalFiles, Mode=OneWay}"/>
                        </TextBlock>
                        <TextBlock Margin="8,0,0,0"
                                   Text="{Binding CurrentFile, Mode=OneWay}"
                                   Foreground="#888"
                                   FontSize="11"
                                   FontStyle="Italic"
                                   MaxWidth="300"
                                   TextTrimming="CharacterEllipsis"/>
                    </StackPanel>
                </Grid>
            </Border>
        </DataTemplate>

    </Window.Resources>

    <Grid>
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="*"/>
            <RowDefinition Height="Auto"/>
        </Grid.RowDefinitions>

        <!-- Header -->
        <Border Grid.Row="0" Background="#2196F3" Padding="20">
            <TextBlock Text="{DynamicResource Header_Title}"
                       FontSize="24"
                       FontWeight="Bold"
                       Foreground="White"/>
        </Border>

        <!-- Main Content -->
        <Grid Grid.Row="1" Margin="20">
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="2*"/>
                <ColumnDefinition Width="Auto"/>
                <ColumnDefinition Width="*" MinWidth="320"/>
            </Grid.ColumnDefinitions>

            <!-- ═══ COLONNE GAUCHE : liste des jobs enregistrés ══════════════ -->
            <Grid Grid.Column="0">
                <Grid.RowDefinitions>
                    <RowDefinition Height="*"/>
                    <RowDefinition Height="Auto"/>
                </Grid.RowDefinitions>

                <GroupBox Grid.Row="0" Header="{DynamicResource Jobs_Header}" Margin="0,0,10,0">
                    <DataGrid ItemsSource="{Binding Jobs}"
                              SelectedItem="{Binding SelectedJob}"
                              AutoGenerateColumns="False"
                              CanUserAddRows="False"
                              SelectionMode="Single">
                        <DataGrid.Columns>
                            <DataGridTextColumn Header="{DynamicResource Col_Name}"
                                                Binding="{Binding Name}" Width="*"/>
                            <DataGridTextColumn Header="{DynamicResource Col_Type}"
                                                Binding="{Binding Type}" Width="100"/>
                            <DataGridTextColumn Header="{DynamicResource Col_Source}"
                                                Binding="{Binding SourceDirectory}" Width="150"/>
                            <DataGridTextColumn Header="{DynamicResource Col_Target}"
                                                Binding="{Binding TargetDirectory}" Width="150"/>
                            <DataGridCheckBoxColumn Header="{DynamicResource Col_Encrypted}"
                                                    Binding="{Binding EnableEncryption}" Width="80"/>
                        </DataGrid.Columns>
                    </DataGrid>
                </GroupBox>

                <!-- Détails du job sélectionné -->
                <GroupBox Grid.Row="1" Header="{DynamicResource Details_Header}" Margin="0,10,10,0">
                    <StackPanel DataContext="{Binding SelectedJob}">
                        <TextBlock Margin="5">
                            <Run Text="{DynamicResource Lbl_Name}"/>
                            <Run Text=" "/>
                            <Run Text="{Binding Name}"/>
                        </TextBlock>
                        <TextBlock Margin="5">
                            <Run Text="{DynamicResource Lbl_Type}"/>
                            <Run Text=" "/>
                            <Run Text="{Binding Type}"/>
                        </TextBlock>
                        <TextBlock Margin="5" TextWrapping="Wrap">
                            <Run Text="{DynamicResource Lbl_Source}"/>
                            <Run Text=" "/>
                            <Run Text="{Binding SourceDirectory}"/>
                        </TextBlock>
                        <TextBlock Margin="5" TextWrapping="Wrap">
                            <Run Text="{DynamicResource Lbl_Target}"/>
                            <Run Text=" "/>
                            <Run Text="{Binding TargetDirectory}"/>
                        </TextBlock>
                        <TextBlock Margin="5">
                            <Run Text="{DynamicResource Lbl_Encryption}"/>
                            <Run Text=" "/>
                            <Run Text="{Binding EnableEncryption}"/>
                        </TextBlock>
                    </StackPanel>
                </GroupBox>
            </Grid>

            <GridSplitter Grid.Column="1"
                          Width="5"
                          HorizontalAlignment="Center"
                          VerticalAlignment="Stretch"
                          Background="LightGray"/>

            <!-- ═══ COLONNE DROITE : actions + monitoring ════════════════════ -->
            <Grid Grid.Column="2" Margin="10,0,0,0">
                <Grid.RowDefinitions>
                    <RowDefinition Height="Auto"/>
                    <RowDefinition Height="*"/>
                </Grid.RowDefinitions>

                <!-- Actions -->
                <GroupBox Grid.Row="0" Header="{DynamicResource Actions_Header}">
                    <StackPanel>
                        <Button Content="{DynamicResource Btn_Create}"
                                Click="CreateJob_Click"
                                Margin="0,5" Padding="10" Height="35"/>

                        <Button Content="{DynamicResource Btn_RunSelected}"
                                Command="{Binding RunJobCommand}"
                                Margin="0,5" Padding="10" Height="35"/>

                        <Button Content="{DynamicResource Btn_RunAll}"
                                Command="{Binding RunAllCommand}"
                                Margin="0,5" Padding="10" Height="35"/>

                        <Button Content="{DynamicResource Btn_Delete}"
                                Command="{Binding DeleteJobCommand}"
                                Margin="0,5" Padding="10" Height="35">
                            <Button.Style>
                                <Style TargetType="Button">
                                    <Setter Property="Background" Value="#F44336"/>
                                    <Setter Property="Foreground" Value="White"/>
                                    <Style.Triggers>
                                        <Trigger Property="IsEnabled" Value="False">
                                            <Setter Property="Background" Value="#F8B5B5"/>
                                            <Setter Property="Foreground" Value="White"/>
                                            <Setter Property="Opacity" Value="0.8"/>
                                        </Trigger>
                                    </Style.Triggers>
                                </Style>
                            </Button.Style>
                        </Button>

                        <Button Content="{DynamicResource Btn_Settings}"
                                Click="AppSettings_Click"
                                Margin="0,5" Padding="10" Height="35"/>

                        <Separator Margin="0,5"/>

                        <!-- Contrôles globaux jobs en cours -->
                        <UniformGrid Columns="3" Margin="0,2">
                            <Button Content="⏸ Pause tous"
                                    Command="{Binding PauseAllCommand}"
                                    Margin="2" Padding="4" Height="30" FontSize="11"/>
                            <Button Content="▶ Reprendre"
                                    Command="{Binding PlayAllCommand}"
                                    Margin="2" Padding="4" Height="30" FontSize="11"/>
                            <Button Content="⏹ Stopper"
                                    Command="{Binding StopAllCommand}"
                                    Margin="2" Padding="4" Height="30" FontSize="11"/>
                        </UniformGrid>
                        <Button Content="🗑 Effacer terminés"
                                Command="{Binding ClearFinishedCommand}"
                                Margin="0,2" Padding="4" Height="30" FontSize="11"/>
                    </StackPanel>
                </GroupBox>

                <!-- Monitoring jobs en cours -->
                <GroupBox Grid.Row="1" Margin="0,10,0,0">
                    <GroupBox.Header>
                        <StackPanel Orientation="Horizontal">
                            <TextBlock Text="{DynamicResource Monitor_Header}"
                                       VerticalAlignment="Center"/>
                            <Border Background="#2196F3" CornerRadius="8"
                                    Margin="6,0,0,0" Padding="6,1">
                                <TextBlock Text="{Binding RunningJobs.Count, Mode=OneWay}"
                                           Foreground="White" FontSize="11" FontWeight="Bold"/>
                            </Border>
                        </StackPanel>
                    </GroupBox.Header>

                    <Grid>
                        <!-- Message si aucun job -->
                        <TextBlock Text="{DynamicResource Monitor_Empty}"
                                   Foreground="#AAAAAA"
                                   FontStyle="Italic"
                                   HorizontalAlignment="Center"
                                   VerticalAlignment="Center">
                            <TextBlock.Style>
                                <Style TargetType="TextBlock">
                                    <Setter Property="Visibility" Value="Collapsed"/>
                                    <Style.Triggers>
                                        <DataTrigger Binding="{Binding RunningJobs.Count, Mode=OneWay}" Value="0">
                                            <Setter Property="Visibility" Value="Visible"/>
                                        </DataTrigger>
                                    </Style.Triggers>
                                </Style>
                            </TextBlock.Style>
                        </TextBlock>

                        <!-- Liste des jobs en cours -->
                        <ScrollViewer VerticalScrollBarVisibility="Auto">
                            <ItemsControl ItemsSource="{Binding RunningJobs}"
                                          ItemTemplate="{StaticResource RunningJobTemplate}"/>
                        </ScrollViewer>
                    </Grid>
                </GroupBox>
            </Grid>
        </Grid>

        <!-- Status Bar -->
        <Border Grid.Row="2"
                Background="#f5f5f5"
                Padding="10"
                BorderThickness="0,1,0,0"
                BorderBrush="#ddd">
            <TextBlock Text="{Binding StatusMessage, Mode=OneWay}" FontSize="12"/>
        </Border>
    </Grid>
</Window>
